<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    
    <title>матограм</title>
    
    <link rel="icon" href="/icon.svg">
    
    <link href="/style.css" rel="stylesheet"></link>
    <link href="/nav.css" rel="stylesheet"></link>
    <link href="/fonts.css" rel="stylesheet"></link>
    <link href="/account/auth.css" rel="stylesheet"></link>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <meta name="theme-color" content="#fff" >
<!--     <link rel="manifest" href="manifest.json"> -->
</head>
<body>

    <div class="header">
        <h1>Аккаунт</h1>
    </div>

    <main>
		<form id="signUpForm"">
			<h2>Регистрация</h2>
			
			<input type="text" name="name" placeholder="Имя" required autocomplete="off"/>
			<input type="text" name="surname" placeholder="Фамилия" required autocomplete="off"/>
			<input type="text" name="alias" placeholder="Псевдоним" required autocomplete="off"/>
			<input type="text" name="email" placeholder="Почта" required autocomplete="off"/>
			<input type="password" name="password" placeholder="Пароль" required autocomplete="off"/>
			<input type="password" name="password2" placeholder="Подтвердите пароль" required autocomplete="off"/>
			
			<input type="submit" name="signup_submit" value="Создать аккаунт" />

			<span style="float:right; font-family:arial; cursor:pointer;" onclick="change()">Уже есть аккаунт? Войти</span>

		</form>

		<form id="logInForm">
			<h2>Вход</h2>
			
			<input type="text" name="email" placeholder="Почта"/>
			<input type="password" name="password" placeholder="Пароль" />
			
			<input type="submit" name="signup_submit" value="Войти" />

			<span style="float:right; font-family:arial; cursor:pointer;" onclick="change()">Нет&nbsp;аккаунта?&nbsp;Зарегистрируйтесь</span>

		</form>
    </main>
    <nav class="nav">
      <a href="/" class="nav__link">
        <i class="material-icons-outlined nav__icon">menu_book</i>
        <span class="nav__text">Узнавай</span>
      </a>
      <a href="/library" class="nav__link">
        <i class="material-icons-outlined nav__icon">library_books</i>
        <span class="nav__text">Библиотека</span>
      </a>
      <a href="/search" class="nav__link">
        <i class="material-icons-outlined nav__icon">search</i>
        <span class="nav__text">Поиск</span>
      </a>
      <a href="/account" class="nav__link nav__link--active">
        <i class="material-icons-outlined nav__icon">person</i>
        <span class="nav__text">Аккаунт</span>
      </a>
    </nav>
</body>

<script>
	var a = true;
	const change = () =>{
		document.querySelector('#logInForm').style.display = (a)?'none':'block';
		document.querySelector('#signUpForm').style.display = (a)?'block':'none';
		a = !a;
	}
</script>
	<script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-analytics.js"></script>
<script>
	var firebaseConfig = {
		apiKey: "AIzaSyDaCcN_m4v0voxufY1icEeXg4UB7JxYLC4",
		authDomain: "math-f15ff.firebaseapp.com",
		databaseURL: "https://math-f15ff.firebaseio.com",
		projectId: "math-f15ff",
		storageBucket: "math-f15ff.appspot.com",
		messagingSenderId: "441322745830",
		appId: "1:441322745830:web:d61ab0215cce860c72f027",
		measurementId: "G-Z8E3MG7K7G"
	};
	firebase.initializeApp(firebaseConfig);
	firebase.analytics();

	const auth = firebase.auth();
	const db = firebase.firestore();

	// to prevent errors with time stamps
	db.settings({timestampsInSnapshots: true})

	// if the user is logged in redirect to main page
	auth.onAuthStateChanged(function(user) {
		if (user){
			console.log("beep"); location.href = '/';
		}else{
			document.querySelector('main').style.display = "block";
		}
	});
</script>
<script>
	const signUpForm = document.querySelector("#signUpForm");
	signUpForm.addEventListener("submit", e =>{
		e.preventDefault()
		const name = signUpForm['name'].value,
			surname = signUpForm['surname'].value,
			email = signUpForm['email'].value,
			password = signUpForm['password'].value,
			alias = signUpForm['alias'].value;
		auth.createUserWithEmailAndPassword(email, password).then(cred =>{
			return db.collection('users').doc(cred.user.uid).set({
				name:name,
				surname:surname,
				alias:alias
			})
		}).then(()=>{
			location.href = "/";
		}).catch(() => {
			alert('произошла ошибка, попробуйте ещё раз или свяжитесь с администрацией')
		})
	})

	const logInForm = document.querySelector("#logInForm")
	logInForm.addEventListener("submit", (e) =>{
		e.preventDefault();
		const email = logInForm["email"].value;
		const password = logInForm["password"].value;

		auth.signInWithEmailAndPassword(email, password).then(cred =>{
			location.href = "/";
		}).catch(() => {
			alert('произошла ошибка, попробуйте ещё раз или свяжитесь с администрацией')
		})
	})	
</script>

</html>